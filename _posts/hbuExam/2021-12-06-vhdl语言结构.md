---
layout: article
title: "硬件专题复习之vhdl语言结构"
date: 2021-12-06
modify_date: 2021-12-06
author: "Bedoom"
mathjax_autoNumber: false
show_tags: true
tags: 
 - HBU考试内容
---

一个完整的 vhdl 程序通常包括实体(Entity)、构造体(Architecture)、配置(configuration)、包集合(package)、库(library)。

![image-20211206212631087](https://gitee.com/bedoom/images/raw/master/202112062126784.png)

<!--more-->

## VHDL基本单元

### 实体说明 Entity

```vhdl
entity 实体名 is
    [类属参数说明];
	[端口说明];
end entity 实体名;
```

实体中的每一个I/O信号都称为一个端口，对应硬件设备上的引脚。端口说明是对一个实体的端口进行定义，即对基本设计实体和外部接口的描述。类属参数说明是可选参数，使用关键字generic定义，可指定该实体类的属性，比如延时，功耗等。 

举个栗子：二输入与门的实体说明如下

```vhdl
entity my_and is
    port(a, b: in bin;
        y: out bin);
end entity my_and;
```

如上所示，**port** 是用来定义端口说明的，一般的**定义格式**如下：

```vhdl
port(端口名{, 端口名}: 端口模式 数据类型;
    端口名{, 端口名}: 端口模式 数据类型;
    ...);
```

端口模式只有三类：``in``， ``out``，  ``inout`` 和 ``buffer``。前面三个看名字就可以知道含义，``in`` 就是数据流入实体，``out`` 是数据流出实体，``inout`` 就是双向端口，这时就会有人奇怪：这三个端口模式已经足够了，那种 ``buffer`` 端口是还有什么用呢。其实 ``buffer`` 端口和双向端口类似但又不完全相同，你可以想象这就是一个缓存池，如果不需要该实体工作的话，就相当于**没有端口**，反之，就相当于 ``inout`` 端口。

如果端口模式没有指定，则该端口处于缺省模式为：IN 
{:.success}

数据类型的话，原则上可以是任意类型，但vhdl原始库只提供了bin和bin_vector两种。

**类属参数说明定义格式**：

```vhdl
generic(参数名: 子类型 := 初始值);
```

类属参数是上层实体向本层实体传递**设计参数**所定义的接口。

将上面的栗子加上类属参数说明。

```vhdl
entity my_add is
    generic(rise, fall: time :=1ns);
	port(a, b: in bin;
        y: out bin);
end entity my_and;
```

**四位加法器实体说明程序(大概率考)**

![image-20211206233030654](https://gitee.com/bedoom/images/raw/master/202112062330063.png){:.shadow}

### 结构体 Architecture

```vhdl
architecture 构造体名 of 实体名 is
		[构造体说明部分];
	begin
		[并发处理语句]；
end  (architecture) 构造体名；
```

构造体说明用来描述结构体中需要用到的变量名，相当于高级语言中的局部变量。begin 到 end 这一块并发代码描述结构体的行为，注意结构体的行为**并发**的。

将之前的例子加上结构体：

```vhdl
entity my_add is
    generic(rise, fall: time :=1ns);
	port(a, b: in bin;
        y: out bin);
end entity my_add;

architecture and2 of my_add is
    signal n: bit;
begin
    u <= a and b;
	y <= u after(rise) when u = '1'
        else u after(fall);
end and2;
```

结构体有3种描述方式：行为描述、结构描述和数据流描述。后面会讲的，留个坑QAQ。
{:.success}

## VHDL基本子结构

在一个规模较大的电路中，通常将电路分成几个相互独立的模块，各模块间互不干预。这样，在一个结构体中，该结构体可以通过几个子结构所构成。vhdl 提供三种子结构形式：

* block
* process
* subprogram

### 块 Block

在传统硬件设计结构中，一个大的电原理图可以分成多个子原理图。在 vhdl 中一个结构体可以分成多个 block ，每个 block 对应这个一个子原理图。因此，电原理图中的分割关系和结构体中块的分割是相同的。

```vhdl
BLOCK [(卫式表达式)]
	[说明语句]；
BEGIN
	[并发处理语句]；
END  BLOCK  块结构名；
```



### 进程 Process

### 子程序 Subprogram

# TODO

* 整理 vhdl 子结构
