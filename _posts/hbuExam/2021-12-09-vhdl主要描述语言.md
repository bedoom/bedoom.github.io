---
layout: article
title: "硬件专题复习之主要描述语句"
date: 2021-12-09
modify_date: 2021-12-09
author: "Bedoom"
mathjax_autoNumber: false
show_tags: true
tags:
  - HBU考试内容
---

这个专题主要带着大家回顾一下之前的内容，没有什么知识点。vhdl主要描述语句有两种：顺序语句和并发语句。

<!--more-->

## 顺序语句

顺序语句只能出现在**进程**或者**子程序**中。

* 顺序赋值语句

  1. 信号赋值

     ```vhdl
     信号 <= 表达式
     ```

     在同一进程中有多个赋值源时，信号赋值是获取**最后的一个赋值源**；当多个赋值源处于不同进程中，就会带来多驱动问题，需要采用决断语句来解决。

  2. 变量赋值

     ```vhdl
     变量 : 表达式
     ```

     变量具有局部性，是一种延迟为0的赋值行为。

* IF语句

  ```vhdl
  if 条件 then
      ...
  else
      ...
  end if;
  ```

  复杂的条件一定要加上括号明确优先级（至于为什么，相信聪明的你已经想到了 :laughing: ）。

* CASE语句

  ```vhdl
  case 表达式 is
      when 选择值 => 顺序语句;
  	when 选择值 => 顺序语句;
  	...
      when others => 顺序语句;
  end case;
  ```

  case 语句的表达形式与 if 语句十分相似。需要注意的是，如果选择值没有涵盖所有表达式的值，则需要 **others** 加以说明。

* LOOP语句

  ```vhdl
  [标号] for [循环变量] in 范围 loop
      ...
  end loop [标号];
  ```

  这个循环变量只能作为赋值源，不能被赋值，它由loop自动更改。

  Eg:

  ```vhdl
  nz := '0';
  for i in 0 to 7 loop
      nz := s(i) or nz;
  end loop;
  ```

## 并发语句

* 进程语句

  进程间的通信是通过传递信号量来实现的。进程之间是并发执行，进程内是顺序执行。为启动进程，必须包括敏感信号表。

* 并发赋值语句

  赋值目标必须是信号，赋值语句是并发的，与块中的先后顺序无关。

  ```vhdl
  信号 <= 赋值源
  ```

* 条件信号代入语句

  ```vhdl
  y <= 表达式1 when 条件1 else
      表达式2 when 条件2 else
      表达式3 when 条件3 else
      表达式4;
  ```

  特点：顺序性，优先性。会先判断条件1，若条件1满足则不再判断。

  Eg:

  ```vhdl
  ARCHITECTURE  data_flow OF xor_gate  IS
  BEGIN
      c <= '0' WHEN a='0' AND b='0'ELSE
           '1' WHEN a='0' AND b='1'ELSE
  		'1' WHEN a='1' AND b='0'ELSE
  		'0' WHEN a='1' AND b='1'ELSE
  		'X';
  END  data-flow； 
  ```

* 选择信号代入语句

  ```vhdl
  y <= 表达式1 when 条件1, 
      表达式2 when 条件2, 
      表达式3 when 条件3,
      表达式4 when others;
  ```

  特点：并行性，无优先性。选择赋值语句不允许条件重叠的现象，也不允许条件涵盖不全，因此一般最后都有others条件。

  Eg:

  ```vhdl
  ARCHITECTURE  data_flow OF xor_gate  IS
  	SIGNAL indata : STD_LOGIC_VECTOR(1 DOWNTO 0);
  BEGIN
  	indata <= a & b;
  WITH  indata  SELECT
  	c <= '0' WHEN "00",
       	 '1' WHEN "01",
  		 '1' WHEN "10",
  		 '0' WHEN "11",
  		 'X' WHEN  others;
  END  data-flow；   
  ```

* 并发过程调用

  下面是之前写过的求 a , b 最大数的子程序。

  ```vhdl
  procedure max(a, b: in integer,
               y: out integer) is
  begin
      if a > b then
          y <= a;
      else
          y <= b;
      end if;
  end max;
  ```

  简单粗暴，直接调用：

  ```vhdl
  ARCHITECTURE behave OF comp IS
      SIGNAL maxout  :  INTEGER;
  BEGIN
      …
      max (x,  y,  maxout);
  …
      END ARCHITECTURE behave;
  ```

  在并发过程调用中，max 会被视为一个进程，其中 x, y, maxout 是敏感信号表。

* generic语句

  用于生成相同的组件，有 for-generic 和 if-generic 两种生成方法。

  for-generate语句常常用来进行重复结构的描述。

  ```vhdl
  标号 for 循环变量 in 范围 generate
      ...
      end generate 标号;
  ```

  if-generate语句主要用于描述含有例外情况的结构。

  ```vhdl
  标号 if 条件 generate
      ...
      end if 标号;
  ```

  Eg：请用vhdl描述下面的电路。

  <div align=center>    <img width = "100%" height = "100%" style="border-radius: 0.3125em;    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);"     src="https://s2.loli.net/2021/12/23/LfoRFWykizt34a8.png">    <br>    <div style="color:orange; border-bottom: 1px solid #d9d9d9;    display: inline-block;    color: #999;    padding: 2px;"></div> </div>

  我们会看到8个一模一样的全加器，如果一个一个写的话会有些麻烦因此可以用 for-generate 来生成。

  ```vhdl
  architecture structual of adder8 is
      --定义组件
      component full_adder is
      	port(a, b, ci: in std_logic;
              co, s: out std_logic);
      end component;
      --co
      signal c: std_logic_vector(7 downto 0);
  begin
      ux: for i in (0 to 7) generate
          --第0个full_adder
          u0: if (i=0) generate
              u0: full_adder port map(a(i), b(i), '0', c(i), s(i));
             	end generate u0;
          u17: if (i>0) generate
          	u17: full_adder port map(a(i), b(i), c(i-1), c(i), s(i));
              end generate u17;
  end structual;
  ```

  

  
