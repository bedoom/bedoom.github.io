I"k<ol>
  <li>
    <p>TCP报文段格式</p>

    <p>源端口和目的端口：用于区分TCP实体上层的传输用户。</p>

    <p>序号：一个TCP连接中传送的每个字节均顺序编号。说明TCP报文中第一个字节的编号。</p>

    <p>确认号：接收方希望接收的下一个字节序号。</p>

    <p>数据偏移：数据部分在TCP报文中的起始位置。</p>

    <p>保留：将来使用，置零。</p>

    <p>URG：指示紧急字段是否有效。</p>

    <p>ACK：确认标志，TCP连接建立后，要传送的TCP报文都将 ACK 字段置1。</p>

    <p>PSH：急迫标志，马上发送数据。</p>

    <p>RST ：复位标志，使通信双方重新实现同步，并初始化某些参数。</p>

    <p>SYN ：同步标志，在建立连接时，用来同步序号。</p>

    <p>FIN：结束标志，释放连接。</p>

    <!--more-->

    <p>窗口大小：接收窗口的大小。</p>

    <p>校验和：计算方法和IP报文的计算方法相同，校验范围是TCP报文头部、用户数据和伪TCP头部。</p>

    <p>紧急指针：紧急数据的字节数。</p>

    <p>选项：扩展功能，最大 40 字节。</p>

    <p><img src="https://gitee.com/bedoom/images/raw/master/202112191047081.svg" alt="绘图文件设计 (6)" /></p>
  </li>
  <li>
    <p>三次握手</p>

    <p><img src="https://gitee.com/bedoom/images/raw/master/202112191047412.svg" alt="绘图文件设计 (7)" /></p>
  </li>
  <li>
    <p>四次挥手</p>

    <p><img src="https://gitee.com/bedoom/images/raw/master/202112191055537.svg" alt="绘图文件设计 (8)" /></p>
  </li>
  <li>
    <p>TCP流量控制</p>

    <p>目的：按照B处理和读取的速度来协调A的发送速度，端到端的问题。</p>

    <p>方法：</p>

    <ul>
      <li>接收方通过<strong>反馈</strong>方法告诉发送方其空闲缓冲区尺寸。</li>
      <li>接收方在其向发送方的TCP段头部的 rwnd 字段“通告”其空闲 buffer 大小。</li>
      <li>发送方限制未确认（“in-flight”）字节的个数 \(\leq\) 接收方发送过来的 rwnd 值。</li>
    </ul>

    <p>捎带问题解决：A方定期发送1B数据探测，让B把最新的空闲缓冲区大小返回给A。</p>
  </li>
  <li>
    <p>TCP拥塞控制</p>

    <ul>
      <li>
        <p>慢启动</p>

        <ol>
          <li>发送方将拥塞窗口设置为1MSS，另外引入一个慢启动阀值 Ssthresh，并将其初始化成一个较高的值。</li>
          <li>发送方发送一个报文段，当收到一个ACK时，就把拥塞窗口+1MSS，容易看出这是一个指数增长。</li>
          <li>当拥塞窗口达到 Ssthresh 时，进入拥塞避免阶段。</li>
        </ol>
      </li>
      <li>
        <p>拥塞避免</p>

        <p>每隔 RTT 才将拥塞窗口+1MSS。这样拥塞窗口慢慢增加直到出现拥塞。</p>

        <p>当检测到TCP报文超时重发时，重新设置拥塞窗口的值为1，同时 Ssthresh 设置为当前拥塞窗口的一半。</p>
      </li>
      <li>
        <p>快重传和快恢复</p>

        <p>快重传算法要求接收方每收到一个失序的报文段就立即给发送方发出重复确认。</p>

        <p>当发送方收到连续3个重复确认时，重新设置慢启动阀值 Ssthresh 为当前拥塞窗口的一半，同时拥塞窗口设置为新的 Ssthresh。</p>
      </li>
    </ul>
  </li>
  <li>
    <p>UDP 报文格式</p>

    <p>源端口和目的端口：发送方进程和接收方进程的端口号</p>

    <p>长度：指示UDP报文的字节长度。</p>

    <p>校验和：对UDP报文进行校验。校验范围是整个UDP报文以及一个12字节的伪头部。</p>

    <p class="info">伪头部包括源IP地址（4B）、目的IP地址（4B）、保留字段（1B）、协议字段（1B）和UDP长度（2B）。保留字段全0，UDP 的协议字段为 17</p>
  </li>
</ol>

:ET